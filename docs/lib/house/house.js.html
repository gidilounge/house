<!DOCTYPE html><html><head><title>house.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../index.js.html" class="source "><span class="base_path">. / </span><span class="file_name">index.js</span></a><a href="../../lib/house/house.js.html" class="source selected"><span class="base_path">lib / house / </span><span class="file_name">house.js</span></a><a href="../../lib/house/index.js.html" class="source "><span class="base_path">lib / house / </span><span class="file_name">index.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>house.js</h1><div class="filepath">lib/house/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><h1>House.Js</h1>

<p>To install house.js just run.</p>

<blockquote>
  <p>sudo npm install -g house</p>
</blockquote>

<p><strong>Warning</strong> - You might have fun.</p>
</td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">house</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    </pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><h2>Configuration</h2>

<p>Start a project in a new folder by running</p>

<blockquote>
  <p>house --init</p>
</blockquote>

<p>Modify the file at config/config.js similar to</p>

<blockquote>
  <p>module.exports.config = { 
   env: "dev", webPort: 8000, webPath: 'web', apiPrefix: 'api'
  }</p>
</blockquote>
</td><td class="code"><div class="highlight"><pre>    
    <span class="nx">house</span><span class="p">.</span><span class="nx">setConfig</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setConfig</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
    <span class="p">}</span>
    </pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><h2>Running House</h2>

<p>From your project folder run </p>

<blockquote>
  <p>house --start</p>
</blockquote>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Config required!&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span> <span class="c1">// &lt;3 node.js</span>
        
        <span class="kd">var</span> <span class="nx">isSecure</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        </pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Reference to our http server</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">house</span><span class="p">.</span><span class="nx">httpServer</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">house</span><span class="p">.</span><span class="nx">frontDoor</span><span class="p">);</span>
        </pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Listen on the port specified in the config</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="nx">isSecure</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">house</span><span class="p">.</span><span class="nx">httpServer</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">house</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">webPort</span><span class="p">);</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server running at http://127.0.0.1:&#39;</span><span class="o">+</span><span class="nx">house</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">webPort</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        </pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Define our request filters</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">house</span><span class="p">.</span><span class="nx">requestFilters</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nx">house</span><span class="p">.</span><span class="nx">form</span><span class="p">,</span>
            <span class="nx">house</span><span class="p">.</span><span class="nx">session</span><span class="p">,</span>
            <span class="nx">house</span><span class="p">.</span><span class="nx">router</span><span class="p">,</span>
            <span class="nx">house</span><span class="p">.</span><span class="nx">backDoor</span>
        <span class="p">];</span>
        
        <span class="k">if</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="nx">cb</span><span class="p">();</span>
    <span class="p">}</span>
    </pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><h3>Welcome HTTP Request!</h3>

<p>Our request handler simply passes the request through our filters</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">frontDoor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">getNextFilter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">house</span><span class="p">.</span><span class="nx">requestFilters</span><span class="p">[</span><span class="nx">x</span><span class="p">];</span> <span class="nx">x</span><span class="o">++</span><span class="p">;</span> <span class="k">return</span> <span class="nx">f</span><span class="p">;</span> <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">nextFilter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">house</span><span class="p">.</span><span class="nx">requestFilters</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">nextFilterFn</span> <span class="o">=</span> <span class="nx">getNextFilter</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">nextFilterFn</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">nextFilterFn</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">nextFilter</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="nx">nextFilter</span><span class="p">();</span>
    <span class="p">};</span>
    </pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><h3>Just in case you end up somewhere you shouldn't be, we kick you out the back.</h3>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">backDoor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">&quot;Error 404: File not found&quot;</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><h2>Routing</h2>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">router</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">){</span>
        </pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Route the requst to our API, or static files.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">house</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">apiPrefix</span><span class="p">)</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">house</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">house</span><span class="p">.</span><span class="nx">paper</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">);</span> <span class="c1">// our static web folder</span>
        <span class="p">}</span>
    <span class="p">};</span>
    </pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><h2>Utilities</h2>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">utils</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">};</span>
    </pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><h2>Logger</h2>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    </pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><h2>Request Sessions</h2>

<p>Parse the request for a returning visitor, user, or first time guest!</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">){</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>TODO </p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">next</span><span class="p">();</span>
    <span class="p">};</span>
    </pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><h2>Request Form Parse</h2>

<p>Parse the requset for encoded data. Beep beep.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">form</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">){</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>TODO use formidable</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">next</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">paperboy</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;paperboy&#39;</span><span class="p">);</span>
    </pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><h2>Static Files</h2>

<p>Anything url that doesn't begin with the <em>apiPrefix</em> will attempt to be served from the <em>webRoot</em> you specify in the config.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">paper</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">){</span>
        <span class="nx">paperboy</span>
            <span class="p">.</span><span class="nx">deliver</span><span class="p">(</span><span class="nx">house</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">webRoot</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Expires&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;X-House&#39;</span><span class="p">,</span> <span class="s1">&#39;Node&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">statCode</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">statCode</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="nx">statCode</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
              <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">&quot;Error &quot;</span> <span class="o">+</span> <span class="nx">statCode</span><span class="p">);</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">otherwise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="nx">next</span><span class="p">();</span>
            <span class="p">});</span>
    <span class="p">};</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><h2>Data Source</h2>

<p>Connection to the data</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">ds</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><h2>Collections</h2>

<p>Data type logic. Ex, posts, files, urls, etc.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">collections</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    </pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><h2>API Server</h2>

<p>URLs beginning with config.apiPrefix will be served from the rest API.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">rest</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;RESTful api&#39;</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><h2>Socket.IO</h2>

<p>TODO serve up socket.io access to the data source in a common way to the rest api</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">house</span><span class="p">.</span><span class="nx">socketio</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">house</span><span class="p">;</span>
<span class="p">});</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Sat Jun 16 2012 05:30:23 GMT-0700 (PDT)  </div><div id="projectname"><a href="../../index.html">&quot;House.Js&quot;</a></div></div></body></html>